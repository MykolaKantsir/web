{# templates/monitoring/current_job_card.html #}
<div class="col job-card"
     data-machine-pk="{{ machine.pk }}"
     data-job-monitor-operation-id="{% if machine.current_job %}{{ machine.current_job.monitor_operation_id }}{% endif %}">
  <div class="card h-100 no-border" id="card-{{ machine.pk }}">
    <div class="card-body p-0">

      {# --- BIG ATTENTION BANNER --- #}
      {% if machine.current_warning %}
      <div role="alert"
           style="
             background:#dc3545; color:#fff; padding:16px;
             font-weight:900; text-transform:uppercase; letter-spacing:.6px;
             text-align:center; border-bottom:4px solid #a71d2a;
             box-shadow:0 0 0 4px rgba(220,53,69,.25) inset;
             animation: attnPulse 1s ease-in-out infinite alternate;
           ">
        ⚠️ {{ machine.current_warning }}
      </div>
      <style>
        @keyframes attnPulse {
          from { filter: brightness(1);    transform: scale(1.00); }
          to   { filter: brightness(1.15); transform: scale(1.01); }
        }
      </style>
      {% endif %}

      <!-- Machine and Job Names -->
      <div class="row machine-row m-0 align-items-center">
        <div class="col-6 text-left">
          <h5>{{ machine.name }}</h5>
        </div>
        <div class="col-6 text-right">
          <h5>
            {% if machine.current_status == 'none' %}
              Not started
            {% else %}
              {{ machine.current_job.name }}
            {% endif %}
          </h5>
        </div>
      </div>

      <!-- Job details: Material, Quantity, Location -->
      <div class="row job-details-row m-0">
        <div class="col-4 text-left">
          <p class="title">Material</p>
          <p class="value">
            {% if machine.current_status == 'none' %}-{% else %}{{ machine.current_job.material }}{% endif %}
          </p>
        </div>
        <div class="col-4 text-center">
          <p class="title">Quantity</p>
          <p class="value">
            {% if machine.current_status == 'none' %}-{% else %}{{ machine.current_job.quantity }}{% endif %}
          </p>
        </div>
        <div class="col-4 text-right">
          <p class="title">Location</p>
          <p class="value">
            {% if machine.current_status == 'none' %}-{% else %}{{ machine.current_job.location }}{% endif %}
          </p>
        </div>
      </div>

      <!-- PDF placeholder container (to center vertically) -->
      <div class="pdf-placeholder-container">
        <div class="pdf-placeholder">
          {% if machine.current_status == 'none' %}
            <p>Not started</p>
          {% else %}
            {% if machine.current_job.drawing_image_base64 %}
              <img src="{{ machine.current_job.drawing_image_base64 }}" alt="Manufacturing Drawing"
                   style="width: 100%; height: 100%; object-fit: cover;" />
            {% else %}
              <p>No drawing available</p>
            {% endif %}
          {% endif %}
        </div>
      </div>

      <!-- Barcode for monitor operation (hidden row, same as next_job_card) -->
      <div class="row job-details-row m-0" hidden>
        <div id="barcode-{{ machine.pk }}" class="col-12 text-center">
          <p class="title">Barcode</p>
          <p class="value">
            {% if machine.current_status != 'none' %}{{ machine.current_job.report_number }}{% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
